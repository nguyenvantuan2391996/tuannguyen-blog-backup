# TrÃ² chÆ¡i cá» Caro - XÃ¢y dá»±ng game chÆ¡i vá»›i Human vÃ  Computer báº±ng JavaScript

**ThÃ¡ng ba báº¥t chá»£t má»™t ngÃ y tráº¯ng tinh hoa sÆ°a vá» Ä‘Ã¢y... HÃ  Ná»™i, Chá»§ Nháº­t 26/02/2023...**

*Ta vÃ´Ì£i bÆ°Æ¡Ìc trÃªn phÃ´Ì phÆ°Æ¡Ì€ng HaÌ€ NÃ´Ì£i*  
*BÃ´Ìƒng gÄƒÌ£p haÌ€ng sÆ°a trÄƒÌng mÃ´Ì£t maÌ€u hoa*  
*TrÄƒÌng caÌ‰ goÌc trÆ¡Ì€i niÌu bÆ°Æ¡Ìc chÃ¢n qua*  
*LÆ°u luyÃªÌn quÌa chuÌ€m hoa sÆ°a lÄƒÌ£ng leÌƒ*

*HÆ°Æ¡ng hoa khÃ´ng nÃ´Ì€ng naÌ€n nhÆ° hoa sÆ°Ìƒa*  
*KhÃ´ng sÄƒÌc maÌ€u tiÌm biÃªÌc caÌnh bÄƒÌ€ng lÄƒng*  
*KhÃ´ng vaÌ€ng thÃ¢Ìƒm mÃ´Ì£t maÌ€u hoa Ä‘iÃªÌ£p lan*  
*MaÌ€ nheÌ£ nhaÌ€ng neÌt duyÃªn sÆ°a trÄƒÌng muÃ´Ìt...*

![](https://voz.vn/attachments/dscf2938-jpg.1678776/ align="center")

# 1\. Giá»›i thiá»‡u

## 1.1. Tá»•ng quan

TrÃ² chÆ¡i cá» caro cÅ©ng khÃ´ng quÃ¡ xa láº¡ vá»›i tuá»•i thÆ¡ cá»§a cÃ¡c báº¡n Ä‘Ãºng khÃ´ng? ChÃºng ta cÃ³ thá»ƒ chÆ¡i cá» caro á»Ÿ cháº¿ Ä‘á»™ ngÆ°á»i vs ngÆ°á»i vá»›i nhau. Hoáº·c nÃ¢ng cao hÆ¡n má»™t chÃºt sáº½ chÆ¡i ngÆ°á»i vá»›i mÃ¡y. VÃ  trá»Ÿ nÃªn fancy hÆ¡n ná»¯a lÃ  chÃºng ta táº¡o ra 2 mÃ¡y cho chÃºng tá»± chÆ¡i vá»›i nhau. á» bÃ i viáº¿t nÃ y cÃ¹ng mÃ¬nh xÃ¢y dá»±ng trÃ² chÆ¡i caro vá»›i 3 cháº¿ Ä‘á»™ nhÃ©:

* Human vs Human
    
* Human vs Computer
    
* Computer vs Computer
    

## 1.2. Giá»›i thiá»‡u trÃ² chÆ¡i

Cá» ca-rÃ´ (hay sá»c ca-rÃ´) lÃ  má»™t trÃ² chÆ¡i dÃ¢n gian. Cá» ca-rÃ´ trong tiáº¿ng Triá»u TiÃªn lÃ  omok (ì˜¤ëª©) vÃ  trong tiáº¿ng Nháº­t lÃ  äº”ç›®ä¸¦ã¹ (gomoku narabe); tiáº¿ng Anh, sá»­ dá»¥ng láº¡i tiáº¿ng Nháº­t, gá»i lÃ  gomoku. Ban Ä‘áº§u loáº¡i cá» nÃ y Ä‘Æ°á»£c chÆ¡i báº±ng cÃ¡c quÃ¢n cá» vÃ¢y (quÃ¢n cá» mÃ u tráº¯ng vÃ  Ä‘en) trÃªn má»™t bÃ n cá» vÃ¢y (19x19). QuÃ¢n Ä‘en Ä‘i trÆ°á»›c vÃ  ngÆ°á»i chÆ¡i láº§n lÆ°á»£t Ä‘áº·t má»™t quÃ¢n cá» cá»§a há» trÃªn giao Ä‘iá»ƒm cÃ²n trá»‘ng. NgÆ°á»i tháº¯ng lÃ  ngÆ°á»i Ä‘áº§u tiÃªn cÃ³ Ä‘Æ°á»£c má»™t chuá»—i liÃªn tá»¥c gá»“m 4 quÃ¢n hÃ ng ngang, hoáº·c dá»c, hoáº·c chÃ©o khÃ´ng bá»‹ cháº·n Ä‘áº§u nÃ o. Má»™t khi Ä‘Ã£ Ä‘áº·t xuá»‘ng, cÃ¡c quÃ¢n cá» khÃ´ng thá»ƒ di chuyá»ƒn hoáº·c bá» ra khá»i bÃ n, do Ä‘Ã³ loáº¡i cá» nÃ y cÃ³ thá»ƒ chÆ¡i báº±ng giáº¥y bÃºt. á» Viá»‡t Nam, cá» nÃ y thÆ°á»ng chÆ¡i trÃªn giáº¥y táº­p há»c sinh (Ä‘Ã£ cÃ³ sáºµn cÃ¡c Ã´ ca-rÃ´), dÃ¹ng bÃºt Ä‘Ã¡nh dáº¥u hÃ¬nh trÃ²n (O) vÃ  chá»¯ X Ä‘á»ƒ Ä‘áº¡i diá»‡n cho 2 quÃ¢n cá».

## 1.3. Luáº­t chÆ¡i

Theo cÃ¡c giáº£i thi Ä‘áº¥u quá»‘c táº¿ hiá»‡n táº¡i, Gomoku Ä‘Æ°á»£c chÆ¡i theo luáº­t Swap2 Ä‘á»ƒ Ä‘Ã¡p á»©ng cÃ´ng báº±ng. NgÆ°á»i Ä‘i trÆ°á»›c xáº¿p 3 quÃ¢n cá» Ä‘áº§u tiÃªn lÃªn bÃ n theo Ã½ muá»‘n vÃ  Ä‘á»ƒ ngÆ°á»i Ä‘i sau chá»n:

* Náº¿u Ä‘á»“ng Ã½ vá»›i tháº¿ cá», ngÆ°á»i Ä‘i sau chá»‰ cáº§n chÆ¡i tiáº¿p tá»« nÆ°á»›c thá»© 4 nhÆ° thÆ°á»ng lá»‡.
    
* Náº¿u khÃ´ng Ä‘á»“ng Ã½ vá»›i tháº¿ cá», ngÆ°á»i Ä‘i sau cÃ³ thá»ƒ Ä‘á»•i bÃªn hoáº·c Ä‘áº·t thÃªm 2 quÃ¢n cá» tiáº¿p theo (táº¡o tháº¿ má»›i) Ä‘á»ƒ ngÆ°á»i Ä‘i trÆ°á»›c chá»n mÃ u (quÃ¢n cá» Ä‘áº§u tiÃªn luÃ´n lÃ  mÃ u Ä‘en), vÃ¡n cá» tiáº¿p tá»¥c nhÆ° thÆ°á»ng lá»‡ tá»« tháº¿ cá» Ä‘Ã³.
    

Theo luáº­t Standard gomoku, má»™t hÃ ng cÃ³ nhiá»u hÆ¡n 5 quÃ¢n liÃªn tiáº¿p cÃ¹ng mÃ u (overline) khÃ´ng Ä‘Æ°á»£c coi lÃ  tháº¯ng lá»£i, tráº­n Ä‘áº¥u váº«n tiáº¿p tá»¥c cho Ä‘áº¿n khi má»™t bÃªn cÃ³ Ä‘Ãºng 5 quÃ¢n trong hÃ ng hoáº·c káº¿t quáº£ sáº½ lÃ  hÃ²a, náº¿u khÃ´ng cÃ³ ai Ä‘Ã¡p á»©ng Ä‘iá»u kiá»‡n Ä‘Ã³. Biáº¿n thá»ƒ Free gomoku thÃ¬ chá»‰ cáº§n cÃ³ tá»« 5 quÃ¢n tháº³ng hÃ ng trá»Ÿ lÃªn, khÃ´ng cáº§n cá»‘ Ä‘á»‹nh pháº£i lÃ  Ä‘Ãºng 5 quÃ¢n nhÆ° luáº­t Standard. Trong thi Ä‘áº¥u quá»‘c táº¿, luáº­t thi Ä‘áº¥u dá»±a trÃªn hÃ¬nh thá»©c: ngÆ°á»i nÃ o Äƒn 5 trÃªn 9 vÃ¡n cá» trÆ°á»›c thÃ¬ tháº¯ng.

# 2\. Cáº¥u trÃºc game project

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1677426859081/41a8ea0a-11fc-4b70-a78a-9d644e3e2486.png align="center")

* **css**: ThÆ° má»¥c lÆ°u cÃ¡c file css Ä‘á»ƒ cÄƒn chá»‰nh, lÃ m Ä‘áº¹p giao diá»‡n.
    
* **images**: ThÆ° má»¥c sáº½ lÆ°u cÃ¡c hÃ¬nh áº£nh cá»§a trÃ² chÆ¡i : PhÃ­m báº¥m, áº£nh ná»n,...
    
* **js**: ThÆ° má»¥c chá»©a cÃ¡c file JavaScript Ä‘á»ƒ xá»­ lÃ½ cÃ¡c chá»©c nÄƒng cá»§a game.
    
* **caro.html, home.html**: Giao diá»‡n trÃ² chÆ¡i.
    

# 3\. XÃ¢y dá»±ng trÃ² chÆ¡i

## 3.1. Giao diá»‡n trÃ² chÆ¡i

* **home.html** : Giao diá»‡n trang chá»§ game Ca-rÃ´
    

```html
<!DOCTYPE html>
<html lang="en">

<link rel="stylesheet" href="../common/css/home.css">
<link rel="stylesheet" href="css/caro.css">

<head>
    <meta charset="UTF-8">
    <title>Home game tic tac toe</title>
</head>
<body>
<div>
    <div class="options">
        <label for="list-type-play"></label><select id="list-type-play" class="hide-option option">
        <option selected="selected" disabled="disabled" value="">Select type play</option>
        <option value="2-players">2 players</option>
        <option value="player-computer">Player and computer</option>
        <option value="computer-computer">Computer and computer</option>
    </select>
    </div>

    <div class="options" style="margin-top: 30px">
        <label for="list-row"></label><select id="list-row" class="hide-option option">
        <option selected="selected" disabled="disabled" value="">Select amount of rows</option>
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="40">40</option>
        <option value="50">50</option>
        <option value="60">60</option>
    </select>
    </div>

    <div class="options" style="margin-top: 30px">
        <label for="list-column"></label><select id="list-column" class="hide-option option">
        <option selected="selected" disabled="disabled" value="">Select amount of columns</option>
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="40">40</option>
        <option value="50">50</option>
        <option value="60">60</option>
    </select>
    </div>
</div>

<div class="button" id="button" onclick="handleLetGo()">Let's go!</div>
</body>
</html>

<script type="text/javascript" src="js/caro-home.js"></script>
```

* **caro.html**: Giao diá»‡n trÃ² chÆ¡i
    

```html
<!DOCTYPE html>
<html lang="en">

<link rel="stylesheet" href="css/caro.css">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game caro</title>
    <link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">
</head>
<body>

<h1>Game caro X-O</h1>
<table id="table_game">
</table>

</body>
</html>

<script type="text/javascript" src="js/constants.js"></script>
<script type="text/javascript" src="js/caro-main.js"></script>
```

* **caro.css**: ThÃªm style vÃ o cÃ¡c pháº§n tá»­ HTML Ä‘Ã³ nhÆ° Ä‘á»•i bá»‘ cá»¥c, mÃ u sáº¯c trang, Ä‘á»•i mÃ u chá»¯ cho trang home vÃ  giao diá»‡n trÃ² chÆ¡i
    

```css
body {
    background-color: rgb(32, 32, 32);
    background-image: url("https://janschreiber.github.io/img2/black-chalk.jpg");
    color: rgb(230, 230, 230);
    text-align: center;
    font-family: 'Indie Flower', 'Comic Sans', cursive;
    font-size: 0.7em;
}
h1 {
    line-height: 1em;
    margin-bottom: 0;
    padding-bottom: 5px;
    font-size: 2.8em;
    font-weight: bold;
}
h2 {
    font-size: 1.3em;
    font-weight: bold;
    padding: 0;
    margin: 0;

}
h3 {
    font-size: 1.1em;
    text-decoration: underline;
    text-decoration-style: dashed;
    padding: 0;
    margin: 10px 0 2px 0;
}
table {
    margin: 2% auto;
    border-collapse: collapse;
}
#table_game {
    position: relative;
    font-size: 120px;
    margin: 1% auto;
    border-collapse: collapse;
}
.td_game {
    border: 4px solid rgb(230, 230, 230);
    width: 90px;
    height: 90px;
    padding: 0;
    vertical-align: middle;
    text-align: center;
}
.fixed {
    width: 90px;
    height: 90px;
    line-height: 90px;
    display: block;
    overflow: hidden;
    cursor: pointer;
}
.td_list {
    text-align: center;
    font-size: 1.3em;
    font-weight: bold;
}
.th_list {
    font-size: 1.3em;
    font-weight: bold;
    text-align: center;
    text-decoration: underline;
}
#restart {
    font-size: 3em;
    width: 1em;
    height: 0.9em;
    cursor: pointer;
    margin: 0 auto;
    overflow: hidden;
}
.x {
    color: darksalmon;
    position: relative;
    top: -8px;
    font-size: 1.2em;
    cursor: default;
}
.o {
    color: aquamarine;
    position: relative;
    top: -7px;
    font-size: 1.0em;
    cursor: default;
}

/* modal background */
.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto; /* enable scroll if needed */
    background-color: black; /* fallback color */
    background-color: rgba(0, 0, 0, 0.6);
}

/* modal content */
.modal-content {
    background-color: rgb(240, 240, 240);
    color: rgb(32, 32, 32);
    font-size: 2em;
    font-weight: bold;
    /* 16 % from the top and centered */
    margin: 16% auto;
    padding: 20px;
    border: 2px solid black;
    border-radius: 10px;
    width: 380px;
    max-width: 80%;
}
.modal-content p {
    margin: 0;
    padding: 0;
}

/* close button for modal dialog */
.close {
    color: rgb(170, 170, 170);
    float: right;
    position: relative;
    top: -25px;
    right: -10px;
    font-size: 34px;
    font-weight: bold;
}
.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

.win-color {
    background-color: rgb(240, 240, 240);
}
```

VÃ¬ pháº§n giao diá»‡n html vÃ  css cÅ©ng khÃ´ng cÃ³ gÃ¬ quÃ¡ phá»©c táº¡p nÃªn cÃ¡c báº¡n cÃ³ thá»ƒ tá»± Ä‘á»c hiá»ƒu nÃ³ nhÃ©! ğŸ˜„ğŸ˜„ğŸ˜„ Sau khi html vÃ  css 1 chÃºt chÃºng ta sáº½ Ä‘Æ°á»£c giao diá»‡n nhÆ° tháº¿ nÃ y.

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1677427583957/cc869fa4-aa06-4e9f-bb28-96eee39a4b87.png align="center")

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1677427590832/d1ee5e93-9a88-44ad-a2b1-accdf1e4120c.png align="center")

## 3.2. Xá»­ lÃ½ cÃ¡c chá»©c nÄƒng cá»§a trÃ² chÆ¡i

**caro-home.js**: Xá»­ lÃ½ cÃ¡c sá»± kiá»‡n, chá»©c nÄƒng á»Ÿ trang home. á» trang nÃ y Ä‘Æ¡n giáº£n chá»‰ cÃ³ 1 sá»± kiá»‡n lÃ  click button **Let's go**. á» chá»©c nÄƒng nÃ y Ä‘Æ¡n giáº£n ta chá»‰ cáº§n truyá»n cÃ¡c tham sá»‘: *cháº¿ Ä‘á»™ chÆ¡i*, *sá»‘ dÃ²ng*, *sá»‘ cá»™t* cá»§a trÃ² chÆ¡i.

```javascript
function handleLetGo() {
    let typePlay = document.getElementById("list-type-play").value;
    let rows = document.getElementById("list-row").value;
    let columns = document.getElementById("list-column").value;

    if (typePlay === "" || rows === "" || columns === "") {
        alert("Vui lÃ²ng chá»n kiá»ƒu chÆ¡i");
        return
    }
    window.location.href = "/game-development/games/caro/caro.html?type=" + typePlay + "&rows=" + rows + "&columns=" + columns;
}
```

**caro-main.js**: Xá»­ lÃ½ cÃ¡c sá»± kiá»‡n cá»§a trÃ² chÆ¡i. Sáº½ cÃ³ ráº¥t nhiá»u sá»± kiá»‡n, chá»©c nÄƒng chÃºng ta cáº§n xÃ¢y dá»±ng. CÃ¹ng mÃ¬nh Ä‘i tá»«ng dÃ²ng code xem nÃ³ lÃ m gÃ¬ nhÃ© ğŸ˜ğŸ˜ğŸ˜

ÄÆ°Æ¡ng nhiÃªn rá»“i, trÃ² chÆ¡i gÃ¬ Ä‘áº§u tiÃªn cÅ©ng pháº£i khá»Ÿi táº¡o cÃ¡c biáº¿n, cÃ¡c sá»± kiá»‡n, nháº¡c, hÃ¬nh áº£nh,... **function init** sáº½ láº¥y thÃ´ng tin *cháº¿ Ä‘á»™ chÆ¡i*, *sá»‘ dÃ²ng*, *sá»‘ cá»™t* tá»« trang home truyá»n qua. Dá»±a vÃ o cÃ¡c thÃ´ng tin Ä‘Ã³ chÃºng ta táº¡o ra 1 ma tráº­n *sá»‘ dÃ²ng* x *sá»‘ cá»™t* Ä‘á»ƒ lÆ°u thÃ´ng tin tráº¡ng thÃ¡i cá»§a trÃ² chÆ¡i vÃ  váº½ báº£ng ma tráº­n nÃ y báº±ng tháº» table

```javascript
let tableXO = document.getElementById("table_game");
tableXO.innerHTML = tableContent
```

Full source code function init

```javascript
function init() {
    player = X;
    matrixGame = [];
    typeGame = TWO_PLAYER;
    const urlParams = new URLSearchParams(window.location.search);
    let rows = urlParams.get("rows");
    let columns = urlParams.get("columns");

    if (rows === "" || columns === "" || (urlParams.get("type") !== TWO_PLAYER && urlParams.get("type") !== COMPUTER && urlParams.get("type") !== COMPUTER_COMPUTER)) {
        window.location.href = "/game-development/games/caro/home.html";
    }

    typeGame = urlParams.get("type")

    // Data table
    let tableXO = document.getElementById("table_game");
    let tableContent = "";

    for (let row = 0; row < rows; row++) {
        let arr = [];
        let rowHTML = "<tr>";
        for (let col = 0; col < columns; col++) {
            arr.push("");
            rowHTML += `<td class="td_game"><div id="` + row.toString() + "-" + col.toString() + `" onclick="handleClick(this.id)" class="fixed"></div></td>`
        }
        rowHTML += "</tr>";

        tableContent += rowHTML;
        matrixGame.push(arr);
    }

    tableXO.innerHTML = tableContent
}

window.addEventListener("load", (event) => {
    init();
});
```

Viá»‡c xá»­ lÃ½ kiá»ƒm tra tráº¡ng thÃ¡i hoÃ  vÃ  chiáº¿n tháº¯ng sau má»—i nÆ°á»›c Ä‘i cá»§a tá»«ng ngÆ°á»i cÅ©ng khÃ´ng quÃ¡ khÃ³:

* Náº¿u tráº¡ng thÃ¡i hoÃ : ChÃºng ta sáº½ loop táº¥t cáº£ cÃ¡c element ma tráº­n tráº¡ng thÃ¡i trÃ² chÆ¡i *sá»‘ dÃ²ng* x *sá»‘ cá»™t*. ChÃºng ta kiá»ƒm tra mÃ  tháº¥y pháº§n tá»­ nÃ o cÃ³ giÃ¡ trá»‹ = "" tá»©c lÃ  chÆ°a cÃ³ nÆ°á»›c Ä‘i á»Ÿ pháº§n tá»« Ä‘Ã³ =&gt; trÃ² chÆ¡i chÆ°a káº¿t thÃºc vÃ  ngÆ°á»£c láº¡i náº¿u cÃ¡c pháº§n tá»­ cá»§a ma tráº­n mÃ  Ä‘á»u != "" =&gt; trÃ² chÆ¡i hoÃ .
    
* Náº¿u tráº¡ng thÃ¡i chiáº¿n tháº¯ng: ChÃºng ta kiá»ƒm tra hÃ ng ngang, dá»c, chÃ©o pháº£i, chÃ©o trÃ¡i. Náº¿u cÃ³ lá»›n hÆ¡n hoáº·c báº±ng 5 nÆ°á»›c chÆ¡i liÃªn tiáº¿p giá»‘ng nhau =&gt; NgÆ°á»i chÆ¡i Ä‘Ã³ dÃ nh chiáº¿n tháº¯ng trÃ² chÆ¡i.
    

Source code:

*Draw*

```javascript
function checkDraw() {
    for (let i = 0; i < matrixGame.length; i++) {
        for (let j = 0; j < matrixGame[0].length; j++) {
            if (matrixGame[i][j] === "") {
                return false
            }
        }
    }

    return true
}
```

*Win*

```javascript
function getHorizontal(x, y, player) {
    let count = 1;
    for (let i = 1; i < 5; i++) {
        if (y + i < matrixGame[0].length && matrixGame[x][y + i] === player) {
            count++;
        } else {
            break
        }
    }

    for (let i = 1; i < 5; i++) {
        if (y - i >= 0 && y - i < matrixGame[0].length && matrixGame[x][y - i] === player) {
            count++;
        } else {
            break
        }
    }

    return count;
}

function getVertical(x, y, player) {
    let count = 1;
    for (let i = 1; i < 5; i++) {
        if (x + i < matrixGame.length && matrixGame[x + i][y] === player) {
            count++;
        } else {
            break
        }
    }

    for (let i = 1; i < 5; i++) {
        if (x - i >= 0 && x - i < matrixGame.length && matrixGame[x - i][y] === player) {
            count++;
        } else {
            break
        }
    }

    return count;
}

function getRightDiagonal(x, y, player) {
    let count = 1;
    for (let i = 1; i < 5; i++) {
        if (x - i >= 0 && x - i < matrixGame.length && y + i < matrixGame[0].length && matrixGame[x - i][y + i] === player) {
            count++;
        } else {
            break
        }
    }

    for (let i = 1; i < 5; i++) {
        if (x + i < matrixGame.length && y - i >= 0 && y - i < matrixGame[0].length && matrixGame[x + i][y - i] === player) {
            count++;
        } else {
            break
        }
    }

    return count;
}

function getLeftDiagonal(x, y, player) {
    let count = 1;
    for (let i = 1; i < 5; i++) {
        if (x - i >= 0 && x - i < matrixGame.length && y - i >= 0 && y - i < matrixGame[0].length && matrixGame[x - i][y - i] === player) {
            count++;
        } else {
            break
        }
    }

    for (let i = 1; i < 5; i++) {
        if (x + i < matrixGame.length && y + i < matrixGame[0].length && matrixGame[x + i][y + i] === player) {
            count++;
        } else {
            break
        }
    }

    return count;
}

function checkWin(points) {
    return getHorizontal(Number(points[0]), Number(points[1]), player) >= 5
    || getVertical(Number(points[0]), Number(points[1]), player) >= 5
    || getRightDiagonal(Number(points[0]), Number(points[1]), player) >= 5
    || getLeftDiagonal(Number(points[0]), Number(points[1]), player) >= 5
}
```

## 3.3. Cháº¿ Ä‘á»™ ngÆ°á»i-ngÆ°á»i

á» 3.2 chÃºng ta xÃ¢y dá»±ng source code Ä‘á»ƒ xá»­ lÃ½ cÃ¡c chá»©c nÄƒng: khá»Ÿi táº¡o game, kiá»ƒm tra tráº¡ng thÃ¡i game: hoÃ , chiáº¿n tháº¯ng. á» 3.3 nÃ y chÃºng ta sáº½ xá»­ lÃ½ sá»± kiá»‡n khi ngÆ°á»i chÆ¡i Ä‘i nÆ°á»›c chÆ¡i cá»§a mÃ¬nh trÃªn ma tráº­n trÃ² chÆ¡i.

* Náº¿u function **processClick** tráº£ vá» win =&gt; thÃ´ng bÃ¡o 1 message ngÆ°á»i chÆ¡i X/O dÃ nh chiáº¿n tháº¯ng =&gt; khá»Ÿi táº¡o láº¡i trÃ² chÆ¡i.
    
* Náº¿u function **processClick** tráº£ vá» draw =&gt; thÃ´ng bÃ¡o 1 message 2 ngÆ°á»i chÆ¡i hoÃ  =&gt; khá»Ÿi táº¡o láº¡i trÃ² chÆ¡i.
    

```javascript
function handleClick(id) {
    switch (processClick(id)) {
        case WIN:
            setTimeout(function () {
                alert("Player: " + player + " is winner");

                // reset game
                init();
            }, 100);
            break;
        case DRAW:
            setTimeout(function () {
                alert("Draw");

                // reset game
                init();
            }, 100);
            break;
    }
}
```

**function processClick**: Xá»­ lÃ½ sá»± khi ngÆ°á»i chÆ¡i Ä‘Ã¡nh nÆ°á»›c cá» cá»§a mÃ¬nh á»Ÿ cháº¿ Ä‘á»™ ngÆ°á»i-ngÆ°á»i. ChÃºng ta thá»±c hiá»‡n cÃ¡c kiá»ƒm tra sau:

* Step 1: Náº¿u vá»‹ trÃ­ Ä‘Ã³ trong ma tráº­n trÃ² chÆ¡i cÃ³ giÃ¡ trá»‹ "X" hoáº·c "O" rá»“i =&gt; Ä‘Ã£ cÃ³ nÆ°á»›c Ä‘Ã¡nh =&gt; return void luÃ´n.
    
* Step 2: Náº¿u ngÆ°á»i chÆ¡i lÃ  X =&gt; Set giÃ¡ trá»‹ vá»‹ trÃ­ Ä‘Ã³ trÃªn ma tráº­n trÃ² chÆ¡i lÃ  "x" =&gt; váº½ hÃ¬nh X trÃªn giao diá»‡n `html document.getElementById(id).innerHTML = XText;`
    
* Step 3: Náº¿u ngÆ°á»i chÆ¡i lÃ  O =&gt; Set giÃ¡ trá»‹ vá»‹ trÃ­ Ä‘Ã³ trÃªn ma tráº­n trÃ² chÆ¡i lÃ  "o" =&gt; váº½ hÃ¬nh X trÃªn giao diá»‡n `html document.getElementById(id).innerHTML = OText;`
    
* Step 4: Kiá»ƒm tra tráº¡ng thÃ¡i game hoÃ  hay win. Náº¿u hoÃ  return "draw", win return "win".
    
* Step 5: Chuyá»ƒn lÆ°á»£t chÆ¡i `javascript player = player === X ? O : X;`
    

```javascript
function processClick(id) {
    let points = id.split("-");

    switch (typeGame) {
        case TWO_PLAYER:

            if (matrixGame[Number(points[0])][Number(points[1])] === X || matrixGame[Number(points[0])][Number(points[1])] === O) {
                return
            }

            if (player === X) {
                matrixGame[Number(points[0])][Number(points[1])] = X;
                document.getElementById(id).innerHTML = XText;
            }

            if (player === O) {
                matrixGame[Number(points[0])][Number(points[1])] = O;
                document.getElementById(id).innerHTML = OText;
            }

            if (checkWin(points)) {
                return WIN;
            }

            // check draw
            if (checkDraw()) {
                return DRAW;
            }

            player = player === X ? O : X;
            break;
        case COMPUTER:
            // source code to process play with computer
    }
}
```

## 3.4. Cháº¿ Ä‘á»™ ngÆ°á»i-computer

CÃ³ ráº¥t nhiá»u thuáº­t toÃ¡n: minimax, leo Ä‘á»“i, hÃ m lÆ°á»£ng giÃ¡,... Ä‘á»ƒ Ã¡p dá»¥ng vÃ o trÃ² chÆ¡i Ä‘á»ƒ lá»±a chá»n ra nÆ°á»›c Ä‘i tá»‘i Æ°u nháº¥t. VÃ­ dá»¥ vá» thuáº­t toÃ¡n minimax

*Giáº£i thuáº­t Minimax Hai ngÆ°á»i chÆ¡i trong game Ä‘Æ°á»£c Ä‘áº¡i diá»‡n lÃ  MAX vÃ  MIN. MAX Ä‘áº¡i diá»‡n cho ngÆ°á»i chÆ¡i luÃ´n muá»‘n chiáº¿n tháº¯ng vÃ  cá»‘ gáº¯ng tá»‘i Æ°u hÃ³a Æ°u tháº¿ cá»§a mÃ¬nh cÃ²n MIN Ä‘áº¡i diá»‡n cho ngÆ°á»i chÆ¡i cá»‘ gáº¯ng cho ngÆ°á»i MAX giÃ nh sá»‘ Ä‘iá»ƒm cÃ ng tháº¥p cÃ ng tá»‘t. Giáº£i thuáº­t Minimax thá»ƒ hiá»‡n báº±ng cÃ¡ch Ä‘á»‹nh trá»‹ cÃ¡c Node trÃªn cÃ¢y trÃ² chÆ¡i: Node thuá»™c lá»›p MAX thÃ¬ gÃ¡n cho nÃ³ giÃ¡ trá»‹ lá»›n nháº¥t cá»§a con Node Ä‘Ã³. Node thuá»™c lá»›p MIN thÃ¬ gÃ¡n cho nÃ³ giÃ¡ trá»‹ nhá» nháº¥t cá»§a con Node Ä‘Ã³. Tá»« cÃ¡c giÃ¡ trá»‹ nÃ y ngÆ°á»i chÆ¡i sáº½ lá»±a chá»n cho mÃ¬nh nÆ°á»›c Ä‘i tiáº¿p theo há»£p lÃ½ nháº¥t.*

![](https://images.viblo.asia/4db4c04a-890f-405c-9399-6e1dd0448a18.png align="center")

á» Ä‘Ã¢y Ä‘á»ƒ Ä‘Æ¡n giáº£n hoÃ¡ chÃºng ta dá»±a vÃ o kinh nghiá»‡m, chiáº¿n lÆ°á»£c cá»§a ngÆ°á»i chÆ¡i Ä‘á»ƒ dÃ nh chiáº¿n tháº¯ng chá»© chÆ°a cáº§n pháº£i Ã¡p dá»¥ng cÃ¡c thuáº­t toÃ¡n hay lÃ  trÃ­ tuá»‡ nhÃ¢n táº¡o

CÃ¡c báº¡n cÃ³ thá»ƒ tham kháº£o thÃªm paper á»Ÿ Ä‘Ã¢y:

See this paper: [L. Victor Allis, H. J. van den Herik, M. P. H. Huntjens, 1993. Go-Moku and Threat-Space Search](https://web.archive.org/web/20140411074912/http://chalmersgomoku.googlecode.com/files/allis1994.pdf)

Váº­y Ä‘á»ƒ Ã¡p dá»¥ng kinh nghiá»‡m, chiáº¿n lÆ°á»£c Ä‘Ã³ vÃ o trÃ² chÆ¡i nhÆ° tháº¿ nÃ o. CÃ¹ng mÃ¬nh xÃ¢y dá»±ng nhÃ© ğŸ˜˜ğŸ˜˜ğŸ˜˜

TrÆ°á»›c háº¿t chÃºng ta táº¡o ra 2 háº±ng sá»‘: *MAP\_SCORE\_COMPUTER*, *MAP\_POINT\_HUMAN*

* *MAP\_SCORE\_COMPUTER*: ChÃºng ta sáº½ kiá»ƒm tra nÆ°á»›c Ä‘Ã¡nh Ä‘Ã³ náº¿u cÃ³ Ä‘á»§ 5 nÆ°á»›c chÆ¡i cá»§a mÃ¡y giá»‘ng liá»n ká» nhau =&gt; giÃ nh chiáº¿n tháº¯ng =&gt; Ä‘iá»ƒm sá»‘ cho nÆ°á»›c Ä‘Ã¡nh Ä‘Ã³ lÃ  dÆ°Æ¡ng vÃ´ cÃ¹ng Infinity. TÆ°Æ¡ng tá»±: 4 nÆ°á»›c liá»n nhau =&gt; 2000 points, 3 nÆ°á»›c liá»n nhau =&gt; 500 points, 2 nÆ°á»›c liá»n nhau =&gt; 300 points, 1 nÆ°á»›c liá»n nhau =&gt; 100 points. Sá»‘ Ä‘iá»ƒm nÃ y Ä‘áº¡i diá»‡n cho viá»‡c *táº¥n cÃ´ng*.
    
* *MAP\_POINT\_HUMAN*: ChÃºng ta sáº½ kiá»ƒm tra nÆ°á»›c Ä‘Ã¡nh Ä‘Ã³ náº¿u cÃ³ Ä‘á»§ 4 nÆ°á»›c chÆ¡i cá»§a ngÆ°á»i giá»‘ng liá»n ká» nhau =&gt; cáº§n Æ°u tiÃªn Ä‘Ã¡nh vÃ o Ä‘Ã¢y Ä‘á»ƒ *phÃ²ng thá»§* =&gt; Ä‘iá»ƒm sá»‘ cho nÆ°á»›c Ä‘Ã¡nh Ä‘Ã³ lÃ  999999. TÆ°Æ¡ng tá»±: 3 nÆ°á»›c liá»n nhau =&gt; 1000 points, 2 nÆ°á»›c liá»n nhau =&gt; 400 points, 1 nÆ°á»›c liá»n nhau =&gt; 10 points, 0 nÆ°á»›c liá»n nhau =&gt; 0 points. Sá»‘ Ä‘iá»ƒm nÃ y Ä‘áº¡i diá»‡n cho viá»‡c *phÃ²ng thá»§*.
    

```javascript
const MAP_SCORE_COMPUTER = new Map([
    [5, Infinity], [4, 2000], [3, 500], [2, 300], [1, 100]
])
const MAP_POINT_HUMAN = new Map([
    [4, 999999], [3, 1000], [2, 400], [1, 10], [0, 0]
])
```

**function getPointsComputer**: Láº¥y vá»‹ trÃ­ Ä‘Ã¡nh cá»§a mÃ¡y

* Step 1: *maxScore* =&gt; sá»‘ Ä‘iá»ƒm lá»›n nháº¥t náº¿u mÃ¡y Ä‘Ã¡nh vÃ o vá»‹ trÃ­ Ä‘Ã³, *listScorePoint* =&gt; danh sÃ¡ch Ä‘iá»ƒm theo tá»«ng theo tá»«ng vá»‹ trÃ­ cÃ³ thá»ƒ trÃªn ma tráº­n trÃ² chÆ¡i, *pointsComputer* =&gt; danh sÃ¡ch cÃ¡c vá»‹ trÃ­ cÃ³ Ä‘iá»ƒm sá»‘ cao nháº¥t náº¿u mÃ¡y Ä‘Ã¡nh vÃ o vá»‹ trÃ­ Ä‘Ã³.
    
* Step 2: Loop ma tráº­n trÃ² chÆ¡i vÃ  kiá»ƒm tra náº¿u vá»‹ trÃ­ Ä‘Ã³ giÃ¡ trá»‹ = "" ( chÆ°a cÃ³ nÆ°á»›c Ä‘i á»Ÿ Ä‘Ã³ ) =&gt; láº¥y sá»‘ nÆ°á»›c liá»n ká» tá»‘i Ä‘a theo chiá»u ngang, dá»c, chÃ©o trÃ¡i, chÃ©o pháº£i =&gt; sá»‘ Ä‘iá»ƒm náº¿u Ä‘Ã¡nh vÃ o vá»‹ trÃ­ Ä‘Ã³ = **MAP\_SCORE\_COMPUTER\[sá»‘ nÆ°á»›c liá»n ká» lá»›n nháº¥t\] + MAP\_POINT\_HUMAN\[sá»‘ nÆ°á»›c liá»n ká» lá»›n nháº¥t\]**
    
* Step 3: Loop danh sÃ¡ch Ä‘iá»ƒm theo tá»«ng theo tá»«ng vá»‹ trÃ­ cÃ³ thá»ƒ trÃªn ma tráº­n trÃ² chÆ¡i =&gt; push vá»‹ trÃ­ mÃ  cÃ³ Ä‘iá»ƒm = maxScore ( sá»‘ Ä‘iá»ƒm tá»‘i Ä‘a ) vÃ o danh sÃ¡ch cÃ¡c vá»‹ trÃ­ cÃ³ Ä‘iá»ƒm sá»‘ cao nháº¥t náº¿u mÃ¡y Ä‘Ã¡nh vÃ o vá»‹ trÃ­ Ä‘Ã³ ( *pointsComputer* )
    
* Step 4: VÃ¬ má»—i tráº¡ng thÃ¡i game Ä‘á»u sáº½ cÃ³ nhiá»u nÆ°á»›c Ä‘i khÃ¡c nhau mÃ  cÃ³ cÃ¹ng sá»‘ Ä‘iá»ƒm tá»‘i Ä‘a =&gt; Ä‘á»ƒ khÃ¡ch quan vÃ  cÃ´ng báº±ng hÆ¡n thÃ¬ chÃºng ta sáº½ random trong pointsComputer.
    

```javascript
function getPointsComputer() {
    let maxScore = -Infinity
    let pointsComputer = []
    let listScorePoint = []
    for (let i = 0; i < matrixGame.length; i++) {
        for (let j = 0; j < matrixGame[0].length; j++) {
            if (matrixGame[i][j] === "") {
                let score = MAP_SCORE_COMPUTER.get(Math.max(getHorizontal(i, j, O),getVertical(i, j, O),getRightDiagonal(i, j, O),getLeftDiagonal(i, j, O))) +
                    MAP_POINT_HUMAN.get(Math.max(getHorizontal(i, j, X),getVertical(i, j, X),getRightDiagonal(i, j, X),getLeftDiagonal(i, j, X)) - 1)
                if (maxScore <= score) {
                    maxScore = score
                    listScorePoint.push({
                        "score": score,
                        "point": [i,j],
                    })
                }
            }
        }
    }

    // get list max score
    for (const element of listScorePoint) {
        if (element.score === maxScore) {
            pointsComputer.push(element.point)
        }
    }
    return pointsComputer[Math.floor(Math.random()*pointsComputer.length)]
}
```

## 3.5. Cháº¿ Ä‘á»™ computer-computer

Cháº¿ Ä‘á»™ nÃ y tháº­t thÃº vá»‹, fancy pháº£i khÃ´ng má»i ngÆ°á»i ğŸ˜„ğŸ˜„ğŸ˜„ á» cháº¿ Ä‘á»™ nÃ y chÃºng ta clone tÆ°Æ¡ng tá»± cÃ¡ch chÆ¡i human-computer. Tháº¿ chá»— lÆ°á»£t chÆ¡i cá»§a human báº±ng 1 computer khÃ¡c. ChÃºng ta váº«n sá»­ dá»¥ng hÃ m getPointsComputer Ä‘á»ƒ láº¥y vá»‹ trÃ­ Ä‘Ã¡nh. ChÃºng ta delay 100ms cho cÃ³ cáº£m giÃ¡c mÃ¡y suy nghÄ© Ä‘Ã¡nh nhÃ© ğŸ˜„ğŸ˜„ğŸ˜„

```javascript
async function ComputerAndComputer(sumPoints) {
    for (let i = 0; i < sumPoints; i++) {
        await delay(100);
        // computer A
        let pointsComputerA = getPointsComputer()
        matrixGame[pointsComputerA[0]][pointsComputerA[1]] = X;
        document.getElementById(pointsComputerA[0].toString() + "-" + pointsComputerA[1].toString()).innerHTML = XText;

        // check win
        if (checkWin(pointsComputerA)) {
            return WIN;
        }

        // check draw
        if (checkDraw()) {
            return DRAW;
        }

        player = player === X ? O : X;

        await delay(100);
        // computer B
        let pointsComputerB = getPointsComputer()
        matrixGame[pointsComputerB[0]][pointsComputerB[1]] = O;
        document.getElementById(pointsComputerB[0].toString() + "-" + pointsComputerB[1].toString()).innerHTML = OText;

        // check win
        if (checkWin(pointsComputerB)) {
            return WIN;
        }

        // check draw
        if (checkDraw()) {
            return DRAW;
        }

        player = player === X ? O : X;
    }
}
```

á» function xá»­ lÃ½ sá»± kiá»‡n load chÃºng ta kiá»ƒm tra náº¿u á»Ÿ cháº¿ Ä‘á»™ *comuter-computer* thÃ¬ sáº½ call function **ComputerAndComputer** Ä‘á»ƒ 2 mÃ¡y tá»± chÆ¡i.

Note : *let sumPoints = matrixGame.length \* matrixGame\[0\].length* tá»•ng sá»‘ nÆ°á»›c tá»‘i Ä‘a mÃ  2 mÃ¡y cÃ³ thá»ƒ Ä‘i Ä‘Æ°á»£c. Náº¿u Ä‘i háº¿t mÃ  khÃ´ng ai tháº¯ng thÃ¬ cá» sáº½ hoÃ .

```javascript
window.addEventListener("load", (event) => {
    init();

    if(typeGame === COMPUTER_COMPUTER) {
        let sumPoints = matrixGame.length * matrixGame[0].length
        ComputerAndComputer(sumPoints).then(state => {
            switch (state) {
                case WIN:
                    setTimeout(function () {
                        alert("Player: " + player + " is winner");

                        // reset game
                        init();
                        location.reload();
                    }, 100);
                    break;
                case DRAW:
                    setTimeout(function () {
                        alert("Draw");

                        // reset game
                        init();
                        location.reload();
                    }, 100);
                    break;
            }
        })
    }
});
```

# 4\. Káº¿t luáº­n

ÄÃ¢y lÃ  1 sá»‘ hÃ¬nh áº£nh vÃ  video káº¿t quáº£ sau khi build code xong nhÃ© má»i ngÆ°á»i ^^

<center><iframe width="560" height="315" src="https://www.youtube.com/embed/jm5ieVDNo8g"></iframe></center>

* Website game: https://nguyenvantuan2391996.github.io/game-development/games/caro/home.html
    
* Source code: https://github.com/nguyenvantuan2391996/game-development/tree/master/games/caro